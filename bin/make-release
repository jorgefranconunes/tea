#!/bin/sh
###########################################################################
#
# Copyright (c) 2001-2010 PDM&FC, All Rights Reserved.
#
#
# Creates the package for release.
#
# NOTE: This script is way to outdated. It will be rewritten soon.
#
#########################################################################

SCRIPT_DIR=`dirname $0`
SCRIPT_NAME=`basename $0` 

teaBaseDir=`cd $SCRIPT_DIR/..; pwd`
pathSep=":"
isUnix=1

case "$OSTYPE" in
    cygwin )
	pathSep=";"
	teaBaseDir=`cygpath --windows "$teaBaseDir" | sed 's/\\\/\\//g'`
	isUnix=0
    ;;
esac





CONF_RELEASE_FILES="
	00README.txt
	apps
	config/tea-core.conf
	config/tea-install.conf.template
	bin/setup
	bin/teadoc	\
	bin/tea-utils	\
	bin/tsh
	doc/javadoc	\
	doc/release-notes.txt	\
	doc/teadoc
	doc/tea-mode.el
	doc/Memos/Faq.txt
	lib/jars/tea-*.jar
"





###########################################################################
#
# 
#
###########################################################################

#
# Makes utility functions available.
#
source ${teaBaseDir}/bin/tea-utils

teaReadCoreConfig $teaBaseDir

teaPackageName=tea-${TEA_VERSION}
teaPackageFile=${teaBaseDir}/${teaPackageName}.tar.gz
tmpDir=/tmp/tea-release.$$
teaReleaseDir=
tmpReleaseDir=${tmpDir}/${teaPackageName}

mkdir $tmpDir
trap "rm -rf $tmpDir" EXIT


#
#
#
echo "Creating release tree..."
rm -rf $tmpReleaseDir
mkdir $tmpReleaseDir
(cd $teaBaseDir; tar cf - $CONF_RELEASE_FILES) | (cd $tmpReleaseDir; tar xf -)

#
# Remove unwanted files. This is because the list of files to include
# in the release may contain directories and that means all its
# contents have been copied to the staging release tree.
#
find $tmpReleaseDir -name \*~ -exec rm -f {} \;
rm -rf `find $tmpReleaseDir -type d -name CVS -print`
rm -rf `find $tmpReleaseDir -type d -name .svn -print`


#
#
#
echo "Creating release package..."
(cd $tmpDir; tar cf - ./${teaPackageName}) | gzip -9 > $teaPackageFile

echo "Done"
